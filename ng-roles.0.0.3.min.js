/**
 * Access control library for angular applications
 * @version v0.0.4 - 2014-05-23
 * @link 
 * @author Kennth Lynne <kenneth.lynne@gmail.com>, Mohamed S.Zaghloul<m.salahz86@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("ngRoles",[]).factory("ngRoles",["$rootScope",function(a){function b(a,b){this.name=a,this.roles=[],b&&b.length&&this.addRoles.apply(this,b)}function c(a,b){this.name=a,this.roles=[],this.applications=[],this.listeners={},b&&b.length&&this.addRoles.apply(this,b)}function d(a){return l.hasOwnProperty(a)?l[a]:null}function e(a){return m.hasOwnProperty(a)?m[a]:null}function f(a,c){var e=d(a);return null===e?l[a]=new b(a,c):c&&c.length&&l[a].addRoles.apply(l[a],c),n.hasOwnProperty(a)||(n[a]=l[a]),l[a]}function g(a,b){var d=e(a);return null===d?m[a]=new c(a,b):b&&b.length&&m[a].addRoles.apply(m[a],b),n.hasOwnProperty(a)||(n[a]=m[a]),m[a]}function h(){var a={},b={};for(var c in l)if(l.hasOwnProperty(c)){a[c]=[];for(var d=0;d<l[c].roles.length;d++)a[c].push(l[c].roles[d])}for(var e in m)if(m.hasOwnProperty(e)){b[e]=[];for(var d=0;d<m[e].roles.length;d++)b[e].push(m[e].roles[d])}return{applications:a,profiles:b}}function j(a){l={},m={};for(var d in a.applications)a.applications.hasOwnProperty(d)&&(l[d]=new b(d),l[d].addRoles.apply(l[d],a.applications[d]));for(var e in a.profiles)a.profiles.hasOwnProperty(e)&&(m[e]=new c(e),m[e].addRoles.apply(m[e],a.profiles[e]))}var k=".",l={},m={};b.prototype.addRoles=function(){for(var b=0;b<arguments.length;b++)-1==this.roles.indexOf(arguments[b])&&(this.roles.push(arguments[b]),a.$emit(this.name+".role.add",arguments[b]));return this},b.prototype.removeRoles=function(){for(var b=0;b<arguments.length;b++)-1!=this.roles.indexOf(arguments[b])&&(this.roles.splice(this.roles.indexOf(arguments[b]),1),a.$emit(this.name+".role.del",arguments[b]));return this},c.prototype.addRoles=function(){for(var b=0;b<arguments.length;b++){var c=arguments[b];if(c.indexOf(k)<=0)throw new Error("A role must have an associated application");if(c=c.split(k,2),!l.hasOwnProperty(c[0]))throw new Error("Application not found");if("*"==c[1]){for(var d=0;d<l[c[0]].roles.length;d++)this.__addRole(c[0],l[c[0]].roles[d]);-1==this.applications.indexOf(c[0])&&(this.listeners[c[0]+".role.add"]=a.$on(c[0]+".role.add",this.__watchNewRoles(this,c[0])),this.listeners[c[0]+".role.del"]=a.$on(c[0]+".role.del",this.__watchRemoveRoles(this,c[0])),this.applications.push(c[0]))}else{if(-1==l[c[0]].roles.indexOf(c[1]))throw new Error("Application "+c[0]+" does not have "+c[1]+" role");this.__addRole(c[0],c[1])}}return this},c.prototype.removeRoles=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b.indexOf(k)<=0)throw new Error("A role must have an associated application");if(b=b.split(k,2),!l.hasOwnProperty(b[0]))throw new Error("Application not found");if("*"==b[1]){for(var c=0;c<l[b[0]].roles.length;c++)this.__removeRole(b[0],l[b[0]].roles[c]);-1!=this.applications.indexOf(b[0])&&(this.listeners[b[0]+".role.add"](),this.listeners[b[0]+".role.del"](),this.applications.splice(this.applications.indexOf(b[0]),1))}else{if(-1==l[b[0]].roles.indexOf(b[1]))throw new Error("Application "+b[0]+" does not have "+b[1]+" role");this.__removeRole(b[0],b[1])}}return this},c.prototype.hasRoles=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b.indexOf(k)<=0)return!1;if(b=b.split(k,2),!l.hasOwnProperty(b[0]))return!1;if("*"==b[1]){for(var c=0;c<l[b[0]].roles.length;c++)if(-1==this.roles.indexOf(b[0]+k+l[b[0]].roles[c]))return!1}else{if(-1==l[b[0]].roles.indexOf(b[1]))try{throw new Error("Application "+b[0]+" does not have "+b[1]+" role")}catch(d){console.error(d.message)}if(-1==this.roles.indexOf(b.join(k)))return!1}}return!0},c.prototype.hasAnyRoles=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!(b.indexOf(k)<=0)&&(b=b.split(k,2),l.hasOwnProperty(b[0])))if("*"==b[1]){for(var c=0;c<l[b[0]].roles.length;c++)if(-1!=this.roles.indexOf(b[0]+k+l[b[0]].roles[c]))return!0}else{if(-1==l[b[0]].roles.indexOf(b[1]))try{throw new Error("Application "+b[0]+" does not have "+b[1]+" role")}catch(d){console.log(d.message)}if(-1!=this.roles.indexOf(b.join(k)))return!0}}return!1},c.prototype.__addRole=function(b,c){var d=b+k+c;-1==this.roles.indexOf(d)&&(this.roles.push(d),a.$emit(this.name+"profile.addrole",c))},c.prototype.__removeRole=function(b,c){var d=b+k+c;-1!=this.roles.indexOf(d)&&(this.roles.splice(this.roles.indexOf(d),1),a.$emit(this.name+"profile.delrole",arguments[i]))},c.prototype.__watchNewRoles=function(a,b){return function(c,d){var e=b+k+d;-1==a.roles.indexOf(e)&&(a.roles.push(e),console.log(e+" role added to "+a.name+" profile because it's own all "+b+" roles."))}},c.prototype.__watchRemoveRoles=function(a,b){return function(c,d){var e=b+k+d;-1!=a.roles.indexOf(e)&&(a.roles.splice(a.roles.indexOf(e),1),console.log(e+" role removed from "+a.name+" profile because it's own all "+b+" roles only."))}};var n={addApplication:f,addProfile:g,getApplication:d,getProfile:e,"import":j,"export":h,setSeparator:function(a){return k=a,this}};return n}]);