/**
 * Access control for Angular applications
 * @version v0.0.0 - 2014-05-25
 * @link 
 * @author Kennth Lynne <kenneth.lynne@gmail.com>, Mohamed S.Zaghloul <m.salahz86@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("ngRoles",[]).provider("ngRoles",function(){var a=".";this.setSeparator=function(b){return a=b,this},this.$get=["$rootScope",function(b){function c(a,b){this.name=a,this.roles=[],b&&b.length&&this.addRoles.apply(this,b)}function d(a,b){this.name=a,this.roles=[],this.applications=[],this.listeners={},b&&b.length&&this.addRoles.apply(this,b)}function e(a){return l.hasOwnProperty(a)?l[a]:null}function f(a){return m.hasOwnProperty(a)?m[a]:null}function g(a,b){var d=e(a);return null===d?l[a]=new c(a,b):b&&b.length&&l[a].addRoles.apply(l[a],b),self.hasOwnProperty(a)||(self[a]=l[a]),l[a]}function h(a,b){var c=f(a);return null===c?m[a]=new d(a,b):b&&b.length&&m[a].addRoles.apply(m[a],b),self.hasOwnProperty(a)||(self[a]=m[a]),m[a]}function j(){var a={},b={};for(var c in l)if(l.hasOwnProperty(c)){a[c]=[];for(var d=0;d<l[c].roles.length;d++)a[c].push(l[c].roles[d])}for(var e in m)if(m.hasOwnProperty(e)){b[e]=[];for(var d=0;d<m[e].roles.length;d++)b[e].push(m[e].roles[d])}return{applications:a,profiles:b}}function k(a){l={},m={};for(var b in a.applications)a.applications.hasOwnProperty(b)&&(l[b]=new c(b),l[b].addRoles.apply(l[b],a.applications[b]));for(var e in a.profiles)a.profiles.hasOwnProperty(e)&&(m[e]=new d(e),m[e].addRoles.apply(m[e],a.profiles[e]))}var l={},m={};return c.prototype.addRoles=function(){for(var a=0;a<arguments.length;a++)-1==this.roles.indexOf(arguments[a])&&(this.roles.push(arguments[a]),b.$emit(this.name+".role.add",arguments[a]));return this},c.prototype.removeRoles=function(){for(var a=0;a<arguments.length;a++)-1!=this.roles.indexOf(arguments[a])&&(this.roles.splice(this.roles.indexOf(arguments[a]),1),b.$emit(this.name+".role.del",arguments[a]));return this},d.prototype.addRoles=function(){for(var c=0;c<arguments.length;c++){var d=arguments[c];if(d.indexOf(a)<=0)throw new Error("A role must have an associated application");if(d=d.split(a,2),!l.hasOwnProperty(d[0]))throw new Error("Application not found");if("*"==d[1]){for(var e=0;e<l[d[0]].roles.length;e++)this.__addRole(d[0],l[d[0]].roles[e]);-1==this.applications.indexOf(d[0])&&(this.listeners[d[0]+".role.add"]=b.$on(d[0]+".role.add",this.__watchNewRoles(this,d[0])),this.listeners[d[0]+".role.del"]=b.$on(d[0]+".role.del",this.__watchRemoveRoles(this,d[0])),this.applications.push(d[0]))}else{if(-1==l[d[0]].roles.indexOf(d[1]))throw new Error("Application "+d[0]+" does not have "+d[1]+" role");this.__addRole(d[0],d[1])}}return this},d.prototype.removeRoles=function(){for(var b=0;b<arguments.length;b++){var c=arguments[b];if(c.indexOf(a)<=0)throw new Error("A role must have an associated application");if(c=c.split(a,2),!l.hasOwnProperty(c[0]))throw new Error("Application not found");if("*"==c[1]){for(var d=0;d<l[c[0]].roles.length;d++)this.__removeRole(c[0],l[c[0]].roles[d]);-1!=this.applications.indexOf(c[0])&&(this.listeners[c[0]+".role.add"](),this.listeners[c[0]+".role.del"](),this.applications.splice(this.applications.indexOf(c[0]),1))}else{if(-1==l[c[0]].roles.indexOf(c[1]))throw new Error("Application "+c[0]+" does not have "+c[1]+" role");this.__removeRole(c[0],c[1])}}return this},d.prototype.hasRoles=function(){for(var b=0;b<arguments.length;b++){var c=arguments[b];if(c.indexOf(a)<=0)return!1;if(c=c.split(a,2),!l.hasOwnProperty(c[0]))return!1;if("*"==c[1]){for(var d=0;d<l[c[0]].roles.length;d++)if(-1==this.roles.indexOf(c[0]+a+l[c[0]].roles[d]))return!1}else{if(-1==l[c[0]].roles.indexOf(c[1]))try{throw new Error("Application "+c[0]+" does not have "+c[1]+" role")}catch(e){console.error(e.message)}if(-1==this.roles.indexOf(c.join(a)))return!1}}return!0},d.prototype.hasAnyRoles=function(){for(var b=0;b<arguments.length;b++){var c=arguments[b];if(!(c.indexOf(a)<=0)&&(c=c.split(a,2),l.hasOwnProperty(c[0])))if("*"==c[1]){for(var d=0;d<l[c[0]].roles.length;d++)if(-1!=this.roles.indexOf(c[0]+a+l[c[0]].roles[d]))return!0}else{if(-1==l[c[0]].roles.indexOf(c[1]))try{throw new Error("Application "+c[0]+" does not have "+c[1]+" role")}catch(e){console.log(e.message)}if(-1!=this.roles.indexOf(c.join(a)))return!0}}return!1},d.prototype.__addRole=function(c,d){var e=c+a+d;-1==this.roles.indexOf(e)&&(this.roles.push(e),b.$emit(this.name+"profile.addrole",d))},d.prototype.__removeRole=function(c,d){var e=c+a+d;-1!=this.roles.indexOf(e)&&(this.roles.splice(this.roles.indexOf(e),1),b.$emit(this.name+"profile.delrole",arguments[i]))},d.prototype.__watchNewRoles=function(b,c){return function(d,e){var f=c+a+e;-1==b.roles.indexOf(f)&&(b.roles.push(f),console.log(f+" role added to "+b.name+" profile because it's own all "+c+" roles."))}},d.prototype.__watchRemoveRoles=function(b,c){return function(d,e){var f=c+a+e;-1!=b.roles.indexOf(f)&&(b.roles.splice(b.roles.indexOf(f),1),console.log(f+" role removed from "+b.name+" profile because it's own all "+c+" roles only."))}},{addApplication:g,addProfile:h,getApplication:e,getProfile:f,"import":k,"export":j}}]});